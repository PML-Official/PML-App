<!DOCTYPE html>
<html>

    <head>

        <title>PML App</title>
        <link rel="stylesheet" href="styles.css">
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&display=swap" rel="stylesheet">
        <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
        <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
        <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
        <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
        <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
        <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
    </head>

    <body>
<div id="opening-screen" style="display: block">
            <div id="logo"><img alt="pml logo" class="pml-logo" src="images/PML White.png"></div>
            <div id="welcome-contain">
            <div id="welcome">
                Welcome To PML
            </div>
            </div>
            
            <div id="options">
                <ul>
                    <!--option 1-->
                    <li>
                        <div id="option1-container">
                            <span class="option1-text">Open File</span>
                            <div class="description">
                                <p>Open new or existing file to code, <br>preview, and save PDF Markup Language.</p>
                            </div>
                            <div id="bttn1contain">
                                <button id="open-button1" class="opening-screen-button" onclick="document.getElementById('file-searcher').click()">Open</button>

                            </div>
                        </div>
                    </li>
            <input type="file" style="display: none;" id="file-searcher" onchange="setFileData(this)"/>
                
            </div>


<!--Script for Changing to main page-->
<script>document.addEventListener('DOMContentLoaded', function() {document.getElementById('file-searcher').addEventListener('change', function() {var block = document.getElementById('opening-screen');block.style.display = block.style.display === 'none' ? 'block' : 'none';document.getElementById('main-page') .style.display = 'block';document.getElementById('appversion-information').style.display = "none"; });});</script>

<!--Parsing Script-->
        <script src="node_modules/pdfkit/js/pdfkit.standalone.js"></script>

        <script src="js/colors.js"></script>
        <script src="js/bases.js"></script>
        <script src="js/tags.js"></script>
        <script src="js/styles.js"></script>
        <script src="js/main.js"></script>
        </div>
<!--End Parsing Script-->
       
    </div>
        <!--Bottom Bar-->
        
        <div class="bottom-bar">
            <img alt="pml logo" class="bottom-logo" src="images/PML White.png" href="https://stashey13.github.io">
            <span class="pipe">|</span>

            <!--Home icon-->
            
            <div class="home-icon">
                <i class="material-symbols-outlined">home</i>  

                <a class="homelink" href="index.html">
                <span class="home-text">Home</span>
            </a>
            </div>
            <!--Developer Guide-->
            <div class="icon-1">   
            <i class="material-symbols-outlined"> 
                developer_guide
            </i>
        
            <a href="https://stashey13.github.io" id="electron-shell">  
                <span class="developer-text">Developer Guide</span>
                </a>
        </div>

            <!--App Version-->
            <div class="icon-2">
                <i class="material-symbols-outlined">
                    backup
                </i>
            
                <span id="app-version-text">App Version</span>
            </div>    

            <!--Settings-->
        <div class="icon-3">
            <i class="material-symbols-outlined">
                settings
            </i>

            <span id="settings-text">Settings</span>
        </div>

            <!--Contact-->


        <div class="icon-4">
            <i class="material-symbols-outlined">
                contact_page
            </i>
            
            <span id="contact-text">Contact</span>
        </div> 
        
        

            
            </div>      
        </div>


        <!--appversion-block-->
        <div id="appversion-information" class="hidden" style="display: none;">
            <span class="av-itext"><b>Version 0.1 &lpar;Beta&rpar;</b></span>
            <i class="material-symbols-outlined" id="close-btn">
                close
            </i>
            <br>
            <span class="explanationtext">
            Welcome to the very first version <br>of the app, 0.1! Right now, we're <br> in beta mode, which means we're <br> still ironing out the kinks and ad-<br>ding cool new features. We'd love <br> your help in making it even better!<br> If you come across any bugs or <br>have ideas on how we can impr-<br>ove, please let us know. Your fee-<br>dback is like gold to us! To Conta-<br>ct, go to PMLlanuguage.com or <br> click the contact button.
            </span>
        </div>


        <script>
    function openLinkExternally(event) {
        event.preventDefault();
        const link = event.target.href;
        shell.openExternal(link);
    }
    document.getElementById('app-version-text').addEventListener('click', function() {
        var block = document.getElementById('appversion-information');
        block.style.display = block.style.display === 'none' ? 'block' : 'none';
    });

    document.getElementById('close-btn').addEventListener('click', function() {
        var block = document.getElementById('appversion-information');
        block.style.display = 'none';
    });
</script>            






<!--Text Editor Section-->






<div id="main-page" style="display:none;">
<div id="main-page-content">


<ul>

    <li id="li1">
<div class="editing-area" id="resizable">
<div class="editor-container">
    
<div class="textovereditor">Edit</div>
    
    <div class="contenteditable-div" id="editor" contenteditable="true"></div>
    
    <div class="runbutton-contain">
        <button class="runbutton" id="runbutton" onclick="setFileData()">
                Run Code
            </button>
    </div>

</div>
</div>
    </li>
    <li id="content">
        <div id="textoveriframe">Preview</div><div class="hidden" id="textovererrors">Language Errors</div>
        <div class="iframe-contain" id="iframe">            
            <iframe id="display-pdf" src="output.pdf" width="900" height="700" class="hidden"></iframe><div id="errors" class="hidden"></div>
        </div>
        <button id="previewbutton" onclick="toggleAndHide(['display-pdf', 'textoveriframe'], ['errors', 'textovererrors']); toggleButtonState('previewbutton', 'errorsbutton')">
            Preview Output
        </button>
        <button id="errorsbutton" onclick="toggleAndHide(['errors', 'textovererrors'], ['display-pdf', 'textoveriframe']); toggleButtonState('errorsbutton', 'previewbutton')">Check for Errors</button>

        
    </li>
    

</ul>
</div>
<!--script for switching tabs-->
<script>

// disable preview button when page first loads
window.onload = function() {
    var previewButton = document.getElementById('previewbutton');
    previewButton.disabled = true;
    previewButton.style.opacity = '0.7';
    previewButton.style.cursor = 'default';
};


    // disabling buttons
    var lastClickedButtonId = null;

function toggleButtonState(clickedButtonId, otherButtonId) {
    if (lastClickedButtonId === clickedButtonId) {
        return;
    }

    var clickedButton = document.getElementById(clickedButtonId);
    var otherButton = document.getElementById(otherButtonId);

    clickedButton.disabled = true;
    clickedButton.style.opacity = "0.7"; 
    clickedButton.style.cursor = "default"; 

    otherButton.disabled = false;
    otherButton.style.opacity = "1"; 
    otherButton.style.cursor = "pointer"; 

    lastClickedButtonId = clickedButtonId;
}

// showing and hiding elements
function  toggleAndHide(elementsToShow, elementsToHide) {
    toggleVisibility(elementsToShow);
    hideElement(elementsToHide);
}
 
function toggleVisibility(elementIds) {
    elementIds.forEach(function(id) {
        var element = document.getElementById(id);
        element.classList.remove('hidden');
    });
}

function hideElement(elementIds) {
    elementIds.forEach(function(id) {
        var element = document.getElementById(id);
        element.classList.add('hidden');
    });
}
 </script>




<style>
    .keyword {color:rgb(223, 27, 27)}
</style>




<!--for changing colors-->
<script>
document.getElementsByClassName("contenteditable-div")[0].addEventListener('input', () => {
    writeToFile(document.getElementsByClassName("contenteditable-div")[0].innerText);
});

const contentDiv = document.querySelector('.contenteditable-div');

function getCaretCharacterOffsetWithin(element) {
    const caretOffset = 0;
    const doc = element.ownerDocument || element.document;
    const win = doc.defaultView || doc.parentWindow;
    let sel;
    let range;
    let preCaretRange;
    let caretOffsetValue = 0;
    if (typeof win.getSelection !== 'undefined') {
        sel = win.getSelection();
        if (sel.rangeCount > 0) {
            range = win.getSelection().getRangeAt(0);
            preCaretRange = range.cloneRange();
            preCaretRange.selectNodeContents(element);
            preCaretRange.setEnd(range.endContainer, range.endOffset);
            caretOffsetValue = preCaretRange.toString().length;
        }
    }
    return caretOffsetValue;
}

function setCaretPosition(element, offset) {
    const range = document.createRange();
    const sel = window.getSelection();
    let currentNode;
    let previousNode;
    let count = 0;
    range.setStart(element, 0);
    range.collapse(true);
    const textNodes = getTextNodesIn(element);
    for (const textNode of textNodes) {
        if (count + textNode.length >= offset) {
            currentNode = textNode;
            break;
        }
        count += textNode.length;
        previousNode = textNode;
    }
    if (currentNode) {
        range.setStart(currentNode, offset - count);
        range.collapse(true);
        sel.removeAllRanges();
        sel.addRange(range);
    }
}

function getTextNodesIn(node) {
    const textNodes = [];
    if (node.nodeType === 3) {
        textNodes.push(node);
    } else {
        const children = node.childNodes;
        for (let i = 0; i < children.length; i++) {
            textNodes.push(...getTextNodesIn(children[i]));
        }
    }
    return textNodes;
}

// Define keywords and their corresponding colors
const keywordColors = {
    // Note for Luke:
    // as you see, it is working as it is now. but when I add special charaters, i.e [h1:, then it stops working. chat gpt got stumped by this one. Line 249 is where the execution of pluses is being carried out. line 251 is were the acutall color changing of the text is being carried out. and line 233 is where the keywords are being declared.
    'h1': 'red',
    'p': 'blue'
};


function highlightKeywords() {
    const cursorOffset = getCaretCharacterOffsetWithin(contentDiv);
    const text = contentDiv.innerText;

    // Remove existing highlighting spans
    contentDiv.querySelectorAll('.keyword').forEach(span => {
        const textNode = document.createTextNode(span.textContent);
        span.parentNode.replaceChild(textNode, span);
    });

    // Highlight keywords with different colors
    Object.keys(keywordColors).forEach(keyword => {
        const regex = new RegExp('\\b' + keyword + '\\b', 'g');
        contentDiv.innerHTML = contentDiv.innerHTML.replace(regex, match => {
            return `<span class="keyword" style="color: ${keywordColors[keyword]}">${match}</span>`;
        });
    });

    // Restore cursor position
    setCaretPosition(contentDiv, cursorOffset);
}

contentDiv.addEventListener('input', highlightKeywords);


// Initial highlighting
highlightKeywords();

</script>


<!--this is the script for pressing enter-->


   <script>
  // Function to handle keydown event
function handleKeyDown(event) {
// Check if the Enter key is pressed
if (event.keyCode === 13) {
// Get the selection and range objects
const selection = window.getSelection();
const range = selection.getRangeAt(0);
// Create a new line break node
        const br = document.createElement('br');
// Insert the line break at the current cursor position
        range.insertNode(br);
// Move the cursor to the end of the newly created line
        range.setStartAfter(br);
        range.setEndAfter(br);
// Collapse the range and set the selection
        range.collapse(false);
        selection.removeAllRanges();
        selection.addRange(range);
// Prevent the default behavior of the Enter key
        event.preventDefault();
    }
// Check if the Backspace key is pressed
    if (event.keyCode === 8) {
        // Get the selection and range objects
        const selection = window.getSelection();
        const range = selection.getRangeAt(0);
// Get the current line text
const currentLineText = range.startContainer.textContent;
        const currentLineOffset = range.startOffset;
// Check if the cursor is at the beginning of the line and the line is empty
        if (currentLineOffset === 0 && currentLineText.trim() === '') {
            // Get the previous sibling node
            const prevNode = range.startContainer.previousSibling;
// Remove the empty line
            if (prevNode && prevNode.nodeName === 'BR') {
                prevNode.parentNode.removeChild(prevNode);
            }
// Prevent the default behavior of the Backspace key
            event.preventDefault();
        }}}
// Function to handle input event
function handleInput(event) {
    // Check if the last character is a line break
    const content = event.target.textContent;
    if (content.endsWith('<br>') || content.endsWith('<br><br>')) {
        // Move the cursor to the end
        const range = document.createRange();
        const selection = window.getSelection();
        range.selectNodeContents(event.target);
        range.collapse(false);
        selection.removeAllRanges();
        selection.addRange(range);
    }}
// Add event listener for the keydown event on the contentDiv
contentDiv.addEventListener('keydown', handleKeyDown);
// Add event listener for the input event on the contentDiv
contentDiv.addEventListener('input', handleInput);
</script>



<!--Command Q-->
<script>
    const {ipcRenderer } = require('electron');

    ipcRenderer.on('togglePageVisibilityTest', () => {
    const block = document.getElementById('appversion-information');

    if (block.style.display === 'block') {
        block.style.display = 'none';
    }  else {
        block.style.display = 'block';
    }
});
</script>

</div>




</html>